https://www.ibm.com/developerworks/cn/java/j-jtp06197.html

# volatile
锁提供了两种主要的特性：互斥和可见性。互斥即一次只允许一个线程持有某个特定的锁，因此可使用该特性实现对共享数据的协调访问协议，这样就只有一个线程能够使用该共享数据。可见性要更加复杂一些，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的。

## volatile变量
volatile变量具有synchronized的可见性特征，但是不具备原子性。线程能够自动发现volatile变量的最新值。可用于提供线程安全，但只能应用于非常有限的一组用例：多个变量之间或者某个变量的当前值于修改后值之间没有约束关系。因此单独使用volatile还不足以实现计数器、互斥锁或任何具有与多个变量相关的不变式的类。

### 正确使用volaile变量的条件
要使volatile变量提供理想的线程安全，必须满足下面两个条件：

* 对变量的写操作不依赖于当前值。
* 该变量没有包含在具有其他变量的不变式中。

第一个条件的限制使volatile变量不能用作线程安全计数器。

### 性能考虑
使用volatile变量的主要原因是其简易性，在某些情形下使用volatile变量要比使用相应的锁简单的多。使用volatile变量次要原因是其性能，某些情况下volatile变量同步机制的性能要优于锁。

## 正确使用volatile的模式
只有在状态真正独立于程序内其他内容时才能使用volatile。

### 模式1 状态标志
布尔状态标志。

这种类型的状态标记的一个公共特性是：通常只有一种状态转换。

### 模式2 一次性安全发布
实现安全发布的一种技术就是将对象引用定义为volatile类型。

### 模式3 独立观察
定期发布观察结果供程序内部使用。

### 模式4 volatile bean模式
在volatile bean模式中，JavaBean被用作一组具有getter和seter方法的独立属性的容器。

## volatile的高级模式
### 模式5 开销较低的读写锁策略
volatile的功能还不足以实现计数器。然而如果读操作远远超过写操作，可以结合使用内部锁和volatile变量来减少公共代码路径的开销。